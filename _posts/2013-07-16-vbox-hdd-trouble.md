---
published: false
layout: post
title: VirtualBox и проблемы с HDD
---

На днях два раза попали с проблемой, которая положила на несколько часов продакшн и заставила понервничать, перезапускать все проекты и следить за поднятием всех подсистем.

Файловая система не выдержала нагрузки и ремаунтнула рут в read-only, в результате чего получилось всё очень и очень плохо - всё лежало.
Проблема оказалась в том, что VirtualBox не успевал сейвить данные на диск, так как в тот момент, когда он хотел это делать(а делал он "по своему желанию"), данных было многовато. Проблема решается ограничением буффера записи контроллера до, как в нашем случае, 1 мб - VirtualBox чаще сейвит всё на диск и проблема, по идее, должна пропасть. Конечно, это сильнее будет изнашивать физический носитель информации, но главное что всё будет работать под сильными нагрузками.

К слову, это вообще очень давняя проблема VB! Вся информация о том, как ограничить буффер, что и как:
https://www.virtualbox.org/manual/ch12.html#ts_config-periodic-flush
